{"ast":null,"code":"import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import _regeneratorRuntime from\"D:/monkeyfruad/Frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"D:/monkeyfruad/Frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _toConsumableArray from\"D:/monkeyfruad/Frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"D:/monkeyfruad/Frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState,useContext}from\"react\";import Axios from\"axios\";import usercontext from\"../context/usercontext\";import\"./listcomment.css\";import*as moment from\"moment\";import\"moment/locale/th\";import _ from\"lodash\";import ClipLoader from\"./clipLoader\";var Listcomment=function Listcomment(_ref){var commentmore=_ref.commentmore,handledeletetorerender=_ref.handledeletetorerender,handleedittorerender=_ref.handleedittorerender;var _useState=useState(),_useState2=_slicedToArray(_useState,2),imagesFile=_useState2[0],setImagesFile=_useState2[1];//สร้าง State เพื่อเก็บไฟล์ที่อัพโหลด\nvar _useState3=useState(),_useState4=_slicedToArray(_useState3,2),files=_useState4[0],Setfiles=_useState4[1];var _useState5=useState(),_useState6=_slicedToArray(_useState5,2),error=_useState6[0],Seterror=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),isActive=_useState8[0],setIsActive=_useState8[1];var _useState9=useState([]),_useState10=_slicedToArray(_useState9,2),item=_useState10[0],Setitem=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),checkedittext=_useState12[0],Setcheckedittext=_useState12[1];var _useState13=useState(),_useState14=_slicedToArray(_useState13,2),textcomment=_useState14[0],Settextcomment=_useState14[1];var _useState15=useState(\"\"),_useState16=_slicedToArray(_useState15,2),edittextcomment=_useState16[0],Setedittextcomment=_useState16[1];var _useState17=useState(),_useState18=_slicedToArray(_useState17,2),imagecomment=_useState18[0],Setimagecomment=_useState18[1];var _useState19=useState(),_useState20=_slicedToArray(_useState19,2),loading=_useState20[0],Setloading=_useState20[1];var _useContext=useContext(usercontext),user=_useContext.user,setUser=_useContext.setUser;var FileUpload=function FileUpload(event){event.preventDefault();// ใส่ไว้ไม่ให้ refresh หน้าเว็บ\nsetImagesFile([]);// reset state รูป เพื่อกันในกรณีที่กดเลือกไฟล์ซ้ำแล้วรูปต่อกันจากอันเดิม\nvar files=event.target.files;//ใช้เพื่อแสดงไฟลทั้งหมดที่กดเลือกไฟล\nSetfiles(_toConsumableArray(files));Seterror();//ทำการวนข้อมูลภายใน Array\nvar _loop=function _loop(){var reader=new FileReader();//ใช้ Class  FileReader เป็นตัวอ่านไฟล์\nreader.readAsDataURL(files[i]);//เป็นคำสั่งสำหรับการแปลง url มาเป็น file\nreader.onloadend=function(){// ใส่ข้อมูลเข้าไปยัง state ผาน  setimagesPreviewUrls\nsetImagesFile(function(prevState){return[].concat(_toConsumableArray(prevState),[reader.result]);});//  PrevState เป็น Parameter ในการเรียก State ก่อนหน้ามาแล้วรวม Array กับ fileที่อัพโหลดเข้ามา\n};};for(var i=0;i<files.length;i++){_loop();}};var handledeleteimage=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(index){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:try{imagesFile.splice(index,1);setImagesFile(_toConsumableArray(imagesFile));files.splice(index,1);Setfiles(_toConsumableArray(files));}catch(err){console.log(err);}case 1:case\"end\":return _context.stop();}}},_callee);}));return function handledeleteimage(_x){return _ref2.apply(this,arguments);};}();var deleted=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(commentid){var postdelete;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return Axios.post(\"http://localhost:7000/post/delete/comment/\".concat(commentid));case 2:postdelete=_context2.sent;setIsActive(false);handledeletetorerender();case 5:case\"end\":return _context2.stop();}}},_callee2);}));return function deleted(_x2){return _ref3.apply(this,arguments);};}();var edit=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:Setcheckedittext(true);setIsActive(false);case 2:case\"end\":return _context3.stop();}}},_callee3);}));return function edit(){return _ref4.apply(this,arguments);};}();var handleedit=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(commentid){var formdata,editcomment;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.prev=0;formdata=new FormData();_.forEach(files,function(file){formdata.append(\"photocomment\",file);});formdata.append(\"edittextcomment\",edittextcomment);formdata.append(\"photocomment\",commentmore.photocomment);Setloading(true);_context4.next=8;return Axios.post(\"http://localhost:7000/post/edit/comment/\".concat(commentid),formdata);case 8:editcomment=_context4.sent;handleedittorerender();setImagesFile([]);Setfiles();Setcheckedittext(false);Setloading(false);_context4.next=19;break;case 16:_context4.prev=16;_context4.t0=_context4[\"catch\"](0);console.log(_context4.t0);case 19:case\"end\":return _context4.stop();}}},_callee4,null,[[0,16]]);}));return function handleedit(_x3){return _ref5.apply(this,arguments);};}();var gg=/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(){return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:try{if(commentmore){Setedittextcomment(commentmore.textcomment);}}catch(err){console.log(err);}case 1:case\"end\":return _context5.stop();}}},_callee5);}));return function gg(){return _ref6.apply(this,arguments);};}();useEffect(function(){gg();},[commentmore]);return/*#__PURE__*/_jsx(\"div\",{children:commentmore?/*#__PURE__*/_jsxs(\"div\",{className:\"row mypostcommentrow\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"column1 mypostcommentrow1\",children:[/*#__PURE__*/_jsx(\"div\",{class:\"vl\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"mypost-comment-img1\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"post-profilecomment-img1\",children:commentmore.photoURL?/*#__PURE__*/_jsx(\"img\",{className:\"img-circle\",src:\"\".concat(commentmore.photoURL.url)}):/*#__PURE__*/_jsx(\"img\",{className:\"img-circle\",src:\"/img/profile.png\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"mypost-comment-name1\",children:[commentmore?\"@\":null,commentmore.username,/*#__PURE__*/_jsxs(\"span\",{className:\"mypost-comment-time1\",children:[\" \",moment(new Date(commentmore.datetime.seconds*1000)).format(\"LTS\"),\" \"]})]}),/*#__PURE__*/_jsx(\"br\",{}),loading?/*#__PURE__*/_jsx(\"div\",{className:\"col-lg-10 col-4\",children:/*#__PURE__*/_jsx(ClipLoader,{loading:loading})}):checkedittext?/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"commenttextarea \",children:/*#__PURE__*/_jsx(\"textarea\",{value:edittextcomment,onChange:function onChange(e){Setedittextcomment(e.target.value);}})}),/*#__PURE__*/_jsxs(\"div\",{className:\"row post-comment-commentsall\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"container-img-holder-imgpreview1\",children:/*#__PURE__*/_jsxs(\"label\",{children:[/*#__PURE__*/_jsx(\"img\",{className:\"uploadprove1\",src:\"/img/addphoto.png\"}),/*#__PURE__*/_jsx(\"input\",{id:\"FileInput\",className:\"uploadspostcomment\",type:\"file\",onChange:FileUpload,multiple:true,accept:\"image/png, image/jpeg , image/jpg\"})]})}),imagesFile?imagesFile.map(function(imagePreviewUrl,index){return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"img\",{className:\"imgpreview1\",alt:\"previewImg\",src:imagePreviewUrl,style:{overflow:\"hidden\"},onMouseOver:function onMouseOver(e){return e.currentTarget.style={transform:\"scale(1.25)\",overflow:\"hidden\"};},onMouseOut:function onMouseOut(e){return e.currentTarget.style={transform:\"scale(1)\",overflow:\"hidden\"};}},index),/*#__PURE__*/_jsx(\"img\",{src:\"/img/delete.png\",onClick:function onClick(){return handledeleteimage(index);}})]});}):commentmore?commentmore.photocomment?commentmore.photocomment.map(function(doc){return/*#__PURE__*/_jsx(\"img\",{src:doc.url});}):null:null]}),/*#__PURE__*/_jsx(\"div\",{className:\"buttoncommentsave1\",children:/*#__PURE__*/_jsx(\"button\",{className:\"buttoncommentsave2\",onClick:function onClick(){return handleedit(commentmore.commentid);},children:\"\\u0E1A\\u0E31\\u0E19\\u0E17\\u0E36\\u0E01\"})})]}):/*#__PURE__*/_jsxs(\"div\",{className:\"mypost-comment-comments1\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"mypostcomment1\",children:commentmore.textcomment}),commentmore.photocomment?commentmore.photocomment.map(function(doc){return/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"img\",{className:\"imgcomment\",src:\"\".concat(doc.url)})});}):null]})]})]}),user&&commentmore.userid==user.uid?/*#__PURE__*/_jsx(\"div\",{className:\"column2 mypostcommentrow2\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"menu-containermypostcommentsetting\",children:[/*#__PURE__*/_jsx(\"div\",{onClick:function onClick(){return setIsActive(!isActive);},className:\"mypostcommentbuttonsetting\",children:/*#__PURE__*/_jsx(\"img\",{className:\"mypostcommentimg-setting\",src:\"/img/setting.png\",alt:\"avatar\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"mypostcommentmenusetting \".concat(isActive?\"active\":\"inactive\"),children:/*#__PURE__*/_jsxs(\"ul\",{className:\"ul-mypostcommentmenusetting\",children:[/*#__PURE__*/_jsx(\"li\",{className:\"li-mypostcommentmenusetting\",children:/*#__PURE__*/_jsx(\"a\",{className:\"a-mypostcommentmenusetting\",onClick:function onClick(){return edit(commentmore.commentid);},children:\"\\u0E41\\u0E01\\u0E49\\u0E44\\u0E02\\u0E04\\u0E2D\\u0E21\\u0E40\\u0E21\\u0E19\\u0E15\\u0E4C\"})}),/*#__PURE__*/_jsx(\"li\",{className:\"li-mypostcommentmenusetting\",children:/*#__PURE__*/_jsxs(\"a\",{className:\"a-mypostcommentmenusetting\",onClick:function onClick(){return deleted(commentmore.commentid);},children:[\" \",\"\\u0E25\\u0E1A\\u0E04\\u0E2D\\u0E21\\u0E40\\u0E21\\u0E19\\u0E15\\u0E4C\",\" \"]})})]})})]})}):null]}):null});};export default Listcomment;","map":{"version":3,"sources":["D:/monkeyfruad/frontend/src/user/components/listcomment.js"],"names":["React","useEffect","useState","useContext","Axios","usercontext","moment","_","ClipLoader","Listcomment","commentmore","handledeletetorerender","handleedittorerender","imagesFile","setImagesFile","files","Setfiles","error","Seterror","isActive","setIsActive","item","Setitem","checkedittext","Setcheckedittext","textcomment","Settextcomment","edittextcomment","Setedittextcomment","imagecomment","Setimagecomment","loading","Setloading","user","setUser","FileUpload","event","preventDefault","target","reader","FileReader","readAsDataURL","i","onloadend","prevState","result","length","handledeleteimage","index","splice","err","console","log","deleted","commentid","post","postdelete","edit","handleedit","formdata","FormData","forEach","file","append","photocomment","editcomment","gg","photoURL","url","username","Date","datetime","seconds","format","e","value","map","imagePreviewUrl","overflow","currentTarget","style","transform","doc","userid","uid"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, useContext } from \"react\";\r\nimport Axios from \"axios\";\r\nimport usercontext from \"../context/usercontext\";\r\nimport \"./listcomment.css\";\r\nimport * as moment from \"moment\";\r\nimport \"moment/locale/th\";\r\nimport _ from \"lodash\";\r\nimport ClipLoader from \"./clipLoader\";\r\nconst Listcomment = ({\r\n  commentmore,\r\n  handledeletetorerender,\r\n  handleedittorerender,\r\n}) => {\r\n  const [imagesFile, setImagesFile] = useState(); //สร้าง State เพื่อเก็บไฟล์ที่อัพโหลด\r\n  const [files, Setfiles] = useState();\r\n  const [error, Seterror] = useState();\r\n  const [isActive, setIsActive] = useState(false);\r\n  const [item, Setitem] = useState([]);\r\n  const [checkedittext, Setcheckedittext] = useState(false);\r\n  const [textcomment, Settextcomment] = useState();\r\n  const [edittextcomment, Setedittextcomment] = useState(\"\");\r\n  const [imagecomment, Setimagecomment] = useState();\r\n  const [loading, Setloading] = useState();\r\n  let { user, setUser } = useContext(usercontext);\r\n\r\n  const FileUpload = (event) => {\r\n    event.preventDefault(); // ใส่ไว้ไม่ให้ refresh หน้าเว็บ\r\n    setImagesFile([]); // reset state รูป เพื่อกันในกรณีที่กดเลือกไฟล์ซ้ำแล้วรูปต่อกันจากอันเดิม\r\n    let files = event.target.files; //ใช้เพื่อแสดงไฟลทั้งหมดที่กดเลือกไฟล\r\n    Setfiles([...files]);\r\n    Seterror();\r\n\r\n    //ทำการวนข้อมูลภายใน Array\r\n    for (var i = 0; i < files.length; i++) {\r\n      let reader = new FileReader(); //ใช้ Class  FileReader เป็นตัวอ่านไฟล์\r\n      reader.readAsDataURL(files[i]); //เป็นคำสั่งสำหรับการแปลง url มาเป็น file\r\n      reader.onloadend = () => {\r\n        // ใส่ข้อมูลเข้าไปยัง state ผาน  setimagesPreviewUrls\r\n        setImagesFile((prevState) => [...prevState, reader.result]);\r\n        //  PrevState เป็น Parameter ในการเรียก State ก่อนหน้ามาแล้วรวม Array กับ fileที่อัพโหลดเข้ามา\r\n      };\r\n    }\r\n  };\r\n\r\n  const handledeleteimage = async (index) => {\r\n    try{  \r\n\r\n      imagesFile.splice(index,1)\r\n      setImagesFile([...imagesFile])  \r\n\r\n      files.splice(index,1)\r\n      Setfiles([...files])\r\n      \r\n      \r\n    }catch (err) {\r\n      console.log(err);\r\n    }   \r\n  }\r\n\r\n\r\n  const deleted = async (commentid) => {\r\n    const postdelete = await Axios.post(\r\n      `http://localhost:7000/post/delete/comment/${commentid}`\r\n    );\r\n    setIsActive(false)\r\n    handledeletetorerender();\r\n  };\r\n\r\n  const edit = async () => {\r\n    Setcheckedittext(true);\r\n    setIsActive(false);\r\n  };\r\n  const handleedit = async (commentid) => {\r\n    try {\r\n      let formdata = new FormData();\r\n      _.forEach(files, (file) => {\r\n        formdata.append(\"photocomment\", file);\r\n      });\r\n      formdata.append(\"edittextcomment\", edittextcomment);\r\n      formdata.append(\"photocomment\", commentmore.photocomment);\r\n\r\n      Setloading(true);\r\n      const editcomment = await Axios.post(\r\n        `http://localhost:7000/post/edit/comment/${commentid}`,\r\n        formdata\r\n      );\r\n\r\n      handleedittorerender();\r\n      setImagesFile([])\r\n      Setfiles()\r\n      Setcheckedittext(false);\r\n      Setloading(false);\r\n    } catch (err) {\r\n      console.log(err);\r\n    }\r\n  };\r\n\r\n  const gg = async () => {\r\n    try {\r\n      if (commentmore) {\r\n        Setedittextcomment(commentmore.textcomment);\r\n      }\r\n    } catch (err) {\r\n      console.log(err);\r\n    }\r\n  };\r\n  useEffect(() => {\r\n    gg();\r\n  }, [commentmore]);\r\n \r\n  return (\r\n    <div>\r\n      {commentmore ? (\r\n        <div className=\"row mypostcommentrow\">\r\n          <div className=\"column1 mypostcommentrow1\">\r\n            <div class=\"vl\"></div>\r\n            <div className=\"mypost-comment-img1\">\r\n              <div className=\"post-profilecomment-img1\">\r\n                {commentmore.photoURL ? (\r\n                  <img\r\n                    className=\"img-circle\"\r\n                    src={`${commentmore.photoURL.url}`}\r\n                  />\r\n                ) : (\r\n                  <img className=\"img-circle\" src=\"/img/profile.png\" />\r\n                )}\r\n              </div>\r\n              <div className=\"mypost-comment-name1\">\r\n                {commentmore ? \"@\" : null}\r\n                {commentmore.username}\r\n                <span className=\"mypost-comment-time1\">\r\n                  {\" \"}\r\n                  {moment(new Date(commentmore.datetime.seconds * 1000)).format(\r\n                    \"LTS\"\r\n                  )}{\" \"}\r\n                </span>\r\n              </div>\r\n              <br />\r\n              {loading ? (\r\n                <div className=\"col-lg-10 col-4\">\r\n                  <ClipLoader loading={loading} />\r\n                </div>\r\n              ) : checkedittext ? (\r\n                <div className=\"row\">\r\n                  <div className=\"commenttextarea \">\r\n                    <textarea\r\n                      value={edittextcomment}\r\n                      onChange={(e) => {\r\n                        Setedittextcomment(e.target.value);\r\n                      }}\r\n                    ></textarea>\r\n                  </div>\r\n\r\n                  <div className=\"row post-comment-commentsall\">\r\n                    <div className=\"container-img-holder-imgpreview1\">\r\n                      <label>\r\n                        <img className=\"uploadprove1\" src=\"/img/addphoto.png\" />\r\n                        <input\r\n                          id=\"FileInput\"\r\n                          className=\"uploadspostcomment\"\r\n                          type=\"file\"\r\n                          onChange={FileUpload}\r\n                          multiple\r\n                          accept=\"image/png, image/jpeg , image/jpg\"\r\n                        />\r\n                      </label>\r\n                    </div>\r\n                    {imagesFile\r\n                      ? imagesFile.map((imagePreviewUrl, index) => {\r\n                          return (\r\n                            <div>\r\n                            <img\r\n                              key={index}\r\n                              className=\"imgpreview1\"\r\n                              alt=\"previewImg\"\r\n                              src={imagePreviewUrl}\r\n                              style={{ overflow: \"hidden\" }}\r\n                              onMouseOver={(e) =>\r\n                                (e.currentTarget.style = {\r\n                                  transform: \"scale(1.25)\",\r\n                                  overflow: \"hidden\",\r\n                                })\r\n                              }\r\n                              onMouseOut={(e) =>\r\n                                (e.currentTarget.style = {\r\n                                  transform: \"scale(1)\",\r\n                                  overflow: \"hidden\",\r\n                                })\r\n                              }\r\n                            />\r\n                            <img src=\"/img/delete.png\"onClick={() => handledeleteimage(index)} />\r\n                            </div>\r\n                          );\r\n                        })\r\n                      : commentmore\r\n                      ? commentmore.photocomment\r\n                        ? commentmore.photocomment.map((doc) => {\r\n                            return <img src={doc.url}></img>;\r\n                          })\r\n                        : null\r\n                      : null}\r\n                  </div>\r\n\r\n                  <div className=\"buttoncommentsave1\">\r\n                    <button\r\n                      className=\"buttoncommentsave2\"\r\n                      onClick={() => handleedit(commentmore.commentid)}\r\n                    >\r\n                      บันทึก\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n              ) : (\r\n                <div className=\"mypost-comment-comments1\">\r\n                  <div className=\"mypostcomment1\">\r\n                    {commentmore.textcomment}\r\n                  </div>\r\n                  {/* {loading ? <ClipLoader /> : <div></div>} */}\r\n                  {commentmore.photocomment\r\n                    ? commentmore.photocomment.map((doc) => {\r\n                        return (\r\n                          <div>\r\n                            <img className=\"imgcomment\" src={`${doc.url}`} />\r\n                          </div>\r\n                        );\r\n                      })\r\n                    : null}\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n          {user && commentmore.userid == user.uid ? (\r\n            <div className=\"column2 mypostcommentrow2\">\r\n              <div className=\"menu-containermypostcommentsetting\">\r\n                <div\r\n                  onClick={() => setIsActive(!isActive)}\r\n                  className=\"mypostcommentbuttonsetting\"\r\n                >\r\n                  <img\r\n                    className=\"mypostcommentimg-setting\"\r\n                    src=\"/img/setting.png\"\r\n                    alt=\"avatar\"\r\n                  ></img>\r\n                </div>\r\n\r\n                <div\r\n                  className={`mypostcommentmenusetting ${\r\n                    isActive ? \"active\" : \"inactive\"\r\n                  }`}\r\n                >\r\n                  <ul className=\"ul-mypostcommentmenusetting\">\r\n                    <li className=\"li-mypostcommentmenusetting\">\r\n                      <a\r\n                        className=\"a-mypostcommentmenusetting\"\r\n                        onClick={() => edit(commentmore.commentid)}\r\n                      >\r\n                        แก้ไขคอมเมนต์\r\n                      </a>\r\n                    </li>\r\n                    <li className=\"li-mypostcommentmenusetting\">\r\n                      <a\r\n                        className=\"a-mypostcommentmenusetting\"\r\n                        onClick={() => deleted(commentmore.commentid)}\r\n                      >\r\n                        {\" \"}\r\n                        ลบคอมเมนต์{\" \"}\r\n                      </a>\r\n                    </li>\r\n                  </ul>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          ) : null}\r\n        </div>\r\n      ) : null}\r\n    </div>\r\n  );\r\n};\r\nexport default Listcomment;\r\n"]},"metadata":{},"sourceType":"module"}