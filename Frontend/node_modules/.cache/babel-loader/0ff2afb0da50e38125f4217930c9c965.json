{"ast":null,"code":"import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import _toConsumableArray from\"D:/monkeyfruad/Frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _regeneratorRuntime from\"D:/monkeyfruad/Frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"D:/monkeyfruad/Frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"D:/monkeyfruad/Frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState,useContext}from\"react\";import Axios from\"axios\";import\"../../user/components/listcomment.css\";import*as moment from\"moment\";import\"moment/locale/th\";import _ from\"lodash\";import{v4 as uuidv4}from\"uuid\";import Modalimage from\"../../user/components/Modalimage\";var Listcommentpost=function Listcommentpost(_ref){var commentmore=_ref.commentmore,handledeletetorerender=_ref.handledeletetorerender,handleedittorerender=_ref.handleedittorerender,setIsActive=_ref.setIsActive,isActive=_ref.isActive;var _useState=useState(),_useState2=_slicedToArray(_useState,2),imagesFile=_useState2[0],setImagesFile=_useState2[1];//สร้าง State เพื่อเก็บไฟล์ที่อัพโหลด\nvar _useState3=useState(),_useState4=_slicedToArray(_useState3,2),imagecomment=_useState4[0],Setimagecomment=_useState4[1];var _useState5=useState(),_useState6=_slicedToArray(_useState5,2),files=_useState6[0],Setfiles=_useState6[1];var _useState7=useState(),_useState8=_slicedToArray(_useState7,2),error=_useState8[0],Seterror=_useState8[1];var _useState9=useState([]),_useState10=_slicedToArray(_useState9,2),item=_useState10[0],Setitem=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),checkedittext=_useState12[0],Setcheckedittext=_useState12[1];var _useState13=useState(),_useState14=_slicedToArray(_useState13,2),textcomment=_useState14[0],Settextcomment=_useState14[1];var _useState15=useState(\"\"),_useState16=_slicedToArray(_useState15,2),edittextcomment=_useState16[0],Setedittextcomment=_useState16[1];var _useState17=useState(),_useState18=_slicedToArray(_useState17,2),imagecomment2=_useState18[0],Setimagecomment2=_useState18[1];var _useState19=useState([]),_useState20=_slicedToArray(_useState19,2),fuck=_useState20[0],Setfuck=_useState20[1];var _useState21=useState(false),_useState22=_slicedToArray(_useState21,2),isopen=_useState22[0],Setisopen=_useState22[1];var _useState23=useState(),_useState24=_slicedToArray(_useState23,2),imagemodal=_useState24[0],Setimagemodal=_useState24[1];var _useState25=useState(),_useState26=_slicedToArray(_useState25,2),loading=_useState26[0],Setloading=_useState26[1];var handleopenmodal=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:Setisopen(true);case 1:case\"end\":return _context.stop();}}},_callee);}));return function handleopenmodal(){return _ref2.apply(this,arguments);};}();var handleclosemodal=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:Setisopen(false);case 1:case\"end\":return _context2.stop();}}},_callee2);}));return function handleclosemodal(){return _ref3.apply(this,arguments);};}();var FileUpload=function FileUpload(event){event.preventDefault();// ใส่ไว้ไม่ให้ refresh หน้าเว็บ\nsetImagesFile([]);var myfuck=[];var files=[];var date=new Date();if(imagecomment){imagecomment.map(/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(doc){var response;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return Axios({method:\"get\",url:doc.url,responseType:\"blob\"});case 2:response=_context3.sent;_context3.next=5;return myfuck.push(new File([response.data],\"filename\".concat(uuidv4(),\".png\"),{type:response.data.type,lastModified:date}));case 5:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x){return _ref4.apply(this,arguments);};}());}setTimeout(function(){if(myfuck){myfuck.forEach(function(doc){files.push(doc);});}console.log(files);var filesnew=[].concat(files,_toConsumableArray(fuck),_toConsumableArray(event.target.files));Setfiles([].concat(files,_toConsumableArray(fuck),_toConsumableArray(event.target.files)));Setfuck(function(prevState){return[].concat(_toConsumableArray(prevState),_toConsumableArray(event.target.files));});Seterror();var _loop=function _loop(){var reader=new FileReader();//ใช้ Class  FileReader เป็นตัวอ่านไฟล์\nreader.readAsDataURL(filesnew[i]);//เป็นคำสั่งสำหรับการแปลง url มาเป็น file\nreader.onloadend=function(){// ใส่ข้อมูลเข้าไปยัง state ผาน  setimagesPreviewUrls\nsetImagesFile(function(prevState){return[].concat(_toConsumableArray(prevState),[reader.result]);});//  PrevState เป็น Parameter ในการเรียก State ก่อนหน้ามาแล้วรวม Array กับ fileที่อัพโหลดเข้ามา\n};};for(var i=0;i<filesnew.length;i++){_loop();}},50);};// console.log(fuck);\n// console.log(imagesFile);\n// console.log(files);\n// console.log(imagecomment)\nconsole.log(imagesFile);var handledeleteimage=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(index){var date,myFile;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:try{if(imagecomment){console.log(\"a\");imagecomment.splice(index,1);Setimagecomment(_toConsumableArray(imagecomment));}if(imagesFile){console.log(\"b\");imagesFile.splice(index,1);setImagesFile(_toConsumableArray(imagesFile));}if(imagesFile&&imagesFile.length===0){setImagesFile();}if(fuck){console.log(\"c\");fuck.splice(index,1);Setfuck(_toConsumableArray(fuck));}date=new Date();myFile=[];if(imagecomment){imagecomment.forEach(/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(doc){var response,data;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return fetch(doc.url);case 2:response=_context4.sent;_context4.next=5;return response.blob();case 5:data=_context4.sent;myFile.push(new File([data],\"filename\".concat(uuidv4(),\".png\"),{type:\"image/png\",lastModified:date}));case 7:case\"end\":return _context4.stop();}}},_callee4);}));return function(_x3){return _ref6.apply(this,arguments);};}());Setfiles(myFile);}if(files){console.log(\"d\");files.splice(index,1);Setfiles(_toConsumableArray(files));}}catch(err){console.log(err);}case 1:case\"end\":return _context5.stop();}}},_callee5);}));return function handledeleteimage(_x2){return _ref5.apply(this,arguments);};}();if(commentmore&&commentmore.photocomment){console.log(commentmore.photocomment);}var deleted=/*#__PURE__*/function(){var _ref7=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(commentid,commentmore){var postdelete;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:console.log(commentmore);_context6.next=3;return Axios.post(\"http://localhost:7000/post/delete/comment/\".concat(commentid),commentmore);case 3:postdelete=_context6.sent;setIsActive(false);Setfuck([]);setImagesFile();Setfiles();handledeletetorerender();case 9:case\"end\":return _context6.stop();}}},_callee6);}));return function deleted(_x4,_x5){return _ref7.apply(this,arguments);};}();var edit=/*#__PURE__*/function(){var _ref8=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee8(){var myfuck,date;return _regeneratorRuntime.wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:Setcheckedittext(true);setIsActive(false);myfuck=[];date=new Date();if(imagecomment){imagecomment.map(/*#__PURE__*/function(){var _ref9=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee7(doc){var response;return _regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:_context7.next=2;return Axios({method:\"get\",url:doc.url,responseType:\"blob\"});case 2:response=_context7.sent;_context7.next=5;return myfuck.push(new File([response.data],\"filename\".concat(uuidv4(),\".png\"),{type:response.data.type,lastModified:date}));case 5:case\"end\":return _context7.stop();}}},_callee7);}));return function(_x6){return _ref9.apply(this,arguments);};}());}setTimeout(function(){Setfiles([].concat(myfuck));},50);case 6:case\"end\":return _context8.stop();}}},_callee8);}));return function edit(){return _ref8.apply(this,arguments);};}();var handleedit=/*#__PURE__*/function(){var _ref10=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee9(commentid){var formdata,editcomment;return _regeneratorRuntime.wrap(function _callee9$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:_context9.prev=0;formdata=new FormData();_.forEach(files,function(file){formdata.append(\"photocomment\",file);});formdata.append(\"edittextcomment\",edittextcomment);formdata.append(\"photocomment\",imagecomment);Setloading(true);_context9.next=8;return Axios.post(\"http://localhost:7000/post/edit/comment/\".concat(commentid),formdata);case 8:editcomment=_context9.sent;handleedittorerender();Setfuck([]);setImagesFile();Setfiles();Setcheckedittext(false);Setloading(false);_context9.next=20;break;case 17:_context9.prev=17;_context9.t0=_context9[\"catch\"](0);console.log(_context9.t0);case 20:case\"end\":return _context9.stop();}}},_callee9,null,[[0,17]]);}));return function handleedit(_x7){return _ref10.apply(this,arguments);};}();var gg=/*#__PURE__*/function(){var _ref11=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee10(){return _regeneratorRuntime.wrap(function _callee10$(_context10){while(1){switch(_context10.prev=_context10.next){case 0:try{if(commentmore){Setedittextcomment(commentmore.textcomment);Setimagecomment(commentmore.photocomment);}}catch(err){console.log(err);}case 1:case\"end\":return _context10.stop();}}},_callee10);}));return function gg(){return _ref11.apply(this,arguments);};}();useEffect(function(){gg();},[commentmore]);// console.log(imagesFile)\nreturn/*#__PURE__*/_jsx(\"div\",{children:commentmore?/*#__PURE__*/_jsx(\"div\",{className:\"postcommentrows\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"post-comment-img1\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"header-post-comment\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"post-profilecomment-img1\",children:commentmore.photoURL?/*#__PURE__*/_jsx(\"img\",{className:\"img-circle\",src:\"\".concat(commentmore.photoURL.url)}):/*#__PURE__*/_jsx(\"img\",{className:\"img-circle\",src:\"/img/profile.png\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"post-comment-name1\",children:[commentmore?\"@\":null,commentmore.username,/*#__PURE__*/_jsxs(\"span\",{className:\"post-comment-time1\",children:[\" \",moment(new Date(commentmore.datetime.seconds*1000)).format(\"LTS\"),\" \"]})]})]}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsxs(\"div\",{className:\"post-comment-comments2\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"postcomment1\",children:commentmore.textcomment}),/*#__PURE__*/_jsxs(\"div\",{className:\"imglistcomment\",children:[imagecomment?imagecomment?imagecomment.map(function(doc){return/*#__PURE__*/_jsx(\"div\",{className:\"imglistcommentpost1\",children:/*#__PURE__*/_jsx(\"img\",{className:\"listcommentpost2\",src:\"\".concat(doc.url),onClick:function onClick(){return Setimagemodal(doc.url),handleopenmodal();}})});}):null:null,/*#__PURE__*/_jsx(Modalimage,{isopen:isopen,handleopenmodal:handleopenmodal,handleclosemodal:handleclosemodal,imagemodal:imagemodal})]})]})]})}):null});};export default Listcommentpost;","map":{"version":3,"sources":["D:/monkeyfruad/frontend/src/admin/components/listcommentpost.js"],"names":["React","useEffect","useState","useContext","Axios","moment","_","v4","uuidv4","Modalimage","Listcommentpost","commentmore","handledeletetorerender","handleedittorerender","setIsActive","isActive","imagesFile","setImagesFile","imagecomment","Setimagecomment","files","Setfiles","error","Seterror","item","Setitem","checkedittext","Setcheckedittext","textcomment","Settextcomment","edittextcomment","Setedittextcomment","imagecomment2","Setimagecomment2","fuck","Setfuck","isopen","Setisopen","imagemodal","Setimagemodal","loading","Setloading","handleopenmodal","handleclosemodal","FileUpload","event","preventDefault","myfuck","date","Date","map","doc","method","url","responseType","response","push","File","data","type","lastModified","setTimeout","forEach","console","log","filesnew","target","prevState","reader","FileReader","readAsDataURL","i","onloadend","result","length","handledeleteimage","index","splice","myFile","fetch","blob","err","photocomment","deleted","commentid","post","postdelete","edit","handleedit","formdata","FormData","file","append","editcomment","gg","photoURL","username","datetime","seconds","format"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, useContext } from \"react\";\r\nimport Axios from \"axios\";\r\nimport \"../../user/components/listcomment.css\";\r\nimport * as moment from \"moment\";\r\nimport \"moment/locale/th\";\r\nimport _ from \"lodash\";\r\nimport { v4 as uuidv4 } from \"uuid\";\r\nimport Modalimage from \"../../user/components/Modalimage\"\r\n\r\n\r\nconst Listcommentpost = ({\r\n  commentmore,\r\n  handledeletetorerender,\r\n  handleedittorerender,\r\n  setIsActive,\r\n  isActive\r\n}) => {\r\n  const [imagesFile, setImagesFile] = useState(); //สร้าง State เพื่อเก็บไฟล์ที่อัพโหลด\r\n  const [imagecomment, Setimagecomment] = useState();\r\n\r\n  const [files, Setfiles] = useState();\r\n  const [error, Seterror] = useState();\r\n  const [item, Setitem] = useState([]);\r\n  const [checkedittext, Setcheckedittext] = useState(false);\r\n  const [textcomment, Settextcomment] = useState();\r\n  const [edittextcomment, Setedittextcomment] = useState(\"\");\r\n  const [imagecomment2, Setimagecomment2] = useState();\r\n  const [fuck, Setfuck] = useState([]);\r\n  const [isopen, Setisopen] = useState(false);\r\n  const [imagemodal, Setimagemodal] = useState();\r\n  const [loading, Setloading] = useState();\r\n\r\n  const handleopenmodal = async() =>{\r\n    Setisopen(true)\r\n  }\r\n  const handleclosemodal = async() =>{\r\n    Setisopen(false)\r\n  }\r\n\r\n  const FileUpload = (event) => {\r\n    event.preventDefault(); // ใส่ไว้ไม่ให้ refresh หน้าเว็บ\r\n\r\n    setImagesFile([]);\r\n    var myfuck = [];\r\n    var files = [];\r\n    let date = new Date();\r\n    if (imagecomment) {\r\n      imagecomment.map(async (doc) => {\r\n        const response = await Axios({\r\n          method: \"get\",\r\n          url: doc.url,\r\n          responseType: \"blob\",\r\n        });\r\n        await myfuck.push(\r\n          new File([response.data], `filename${uuidv4()}.png`, {\r\n            type: response.data.type,\r\n            lastModified: date,\r\n          })\r\n        );\r\n      });\r\n    }\r\n\r\n    setTimeout(() => {\r\n      if (myfuck) {\r\n        myfuck.forEach((doc) => {\r\n          files.push(doc);\r\n        });\r\n      }\r\n      console.log(files);\r\n\r\n      let filesnew = [...files, ...fuck, ...event.target.files];\r\n\r\n      Setfiles([...files, ...fuck, ...event.target.files]);\r\n      Setfuck((prevState) => [...prevState, ...event.target.files]);\r\n      Seterror();\r\n\r\n      for (var i = 0; i < filesnew.length; i++) {\r\n        let reader = new FileReader(); //ใช้ Class  FileReader เป็นตัวอ่านไฟล์\r\n        reader.readAsDataURL(filesnew[i]); //เป็นคำสั่งสำหรับการแปลง url มาเป็น file\r\n        reader.onloadend = () => {\r\n          // ใส่ข้อมูลเข้าไปยัง state ผาน  setimagesPreviewUrls\r\n          setImagesFile((prevState) => [...prevState, reader.result]);\r\n          //  PrevState เป็น Parameter ในการเรียก State ก่อนหน้ามาแล้วรวม Array กับ fileที่อัพโหลดเข้ามา\r\n        };\r\n      }\r\n    }, 50);\r\n  };\r\n  // console.log(fuck);\r\n  // console.log(imagesFile);\r\n  // console.log(files);\r\n  // console.log(imagecomment)\r\n  console.log(imagesFile);\r\n\r\n  const handledeleteimage = async (index) => {\r\n    try {\r\n      if (imagecomment) {\r\n        console.log(\"a\");\r\n        imagecomment.splice(index, 1);\r\n        Setimagecomment([...imagecomment]);\r\n      }\r\n      if (imagesFile) {\r\n        console.log(\"b\");\r\n        imagesFile.splice(index, 1);\r\n        setImagesFile([...imagesFile]);\r\n      }\r\n      if (imagesFile && imagesFile.length === 0) {\r\n        setImagesFile();\r\n      }\r\n\r\n      if (fuck) {\r\n        console.log(\"c\");\r\n        fuck.splice(index, 1);\r\n        Setfuck([...fuck]);\r\n      }\r\n\r\n      let date = new Date();\r\n      var myFile = [];\r\n      if (imagecomment) {\r\n        imagecomment.forEach(async (doc) => {\r\n          const response = await fetch(doc.url);\r\n          const data = await response.blob();\r\n          myFile.push(\r\n            new File([data], `filename${uuidv4()}.png`, {\r\n              type: \"image/png\",\r\n              lastModified: date,\r\n            })\r\n          );\r\n        });\r\n        Setfiles(myFile);\r\n      }\r\n      if (files) {\r\n        console.log(\"d\");\r\n        files.splice(index, 1);\r\n        Setfiles([...files]);\r\n      }\r\n    } catch (err) {\r\n      console.log(err);\r\n    }\r\n  };\r\n  if(commentmore && commentmore.photocomment){\r\n    console.log(commentmore.photocomment)\r\n  }\r\n  const deleted = async (commentid,commentmore) => {\r\n      console.log(commentmore)\r\n    const postdelete = await Axios.post(\r\n      `http://localhost:7000/post/delete/comment/${commentid}`,commentmore);\r\n    setIsActive(false);\r\n    Setfuck([]);\r\n    setImagesFile();\r\n    Setfiles();\r\n    handledeletetorerender();\r\n  };\r\n\r\n  const edit = async () => {\r\n    Setcheckedittext(true);\r\n    setIsActive(false);\r\n    var myfuck = [];\r\n    let date = new Date();\r\n    if (imagecomment) {\r\n      imagecomment.map(async (doc) => {\r\n        const response = await Axios({\r\n          method: \"get\",\r\n          url: doc.url,\r\n          responseType: \"blob\",\r\n        });\r\n        await myfuck.push(\r\n          new File([response.data], `filename${uuidv4()}.png`, {\r\n            type: response.data.type,\r\n            lastModified: date,\r\n          })\r\n        );\r\n      });\r\n    }\r\n    setTimeout(() => {\r\n      Setfiles([...myfuck]);\r\n    }, 50);\r\n  };\r\n  const handleedit = async (commentid) => {\r\n    try {\r\n      let formdata = new FormData();\r\n      _.forEach(files, (file) => {\r\n        formdata.append(\"photocomment\", file);\r\n      });\r\n      formdata.append(\"edittextcomment\", edittextcomment);\r\n      formdata.append(\"photocomment\", imagecomment);\r\n\r\n      Setloading(true);\r\n      const editcomment = await Axios.post(\r\n        `http://localhost:7000/post/edit/comment/${commentid}`,\r\n        formdata\r\n      );\r\n\r\n      handleedittorerender();\r\n      Setfuck([]);\r\n      setImagesFile();\r\n      Setfiles();\r\n      Setcheckedittext(false);\r\n      Setloading(false);\r\n    } catch (err) {\r\n      console.log(err);\r\n    }\r\n  };\r\n\r\n  const gg = async () => {\r\n    try {\r\n      if (commentmore) {\r\n        Setedittextcomment(commentmore.textcomment);\r\n        Setimagecomment(commentmore.photocomment);\r\n      }\r\n    } catch (err) {\r\n      console.log(err);\r\n    }\r\n  };\r\n  useEffect(() => {\r\n    gg();\r\n  }, [commentmore]);\r\n\r\n  // console.log(imagesFile)\r\n  return (\r\n    <div>\r\n      {commentmore ? (\r\n        <div className=\"postcommentrows\">\r\n          {/* <div class=\"vl\"></div> */}\r\n          <div className=\"post-comment-img1\">\r\n            <div className=\"header-post-comment\">\r\n              <div className=\"post-profilecomment-img1\">\r\n                {commentmore.photoURL ? (\r\n                  <img\r\n                    className=\"img-circle\"\r\n                    src={`${commentmore.photoURL.url}`}\r\n                  />\r\n                ) : (\r\n                  <img className=\"img-circle\" src=\"/img/profile.png\" />\r\n                )}\r\n              </div>\r\n              <div className=\"post-comment-name1\">\r\n                {commentmore ? \"@\" : null}\r\n                {commentmore.username}\r\n                <span className=\"post-comment-time1\">\r\n                  {\" \"}\r\n                  {moment(new Date(commentmore.datetime.seconds * 1000)).format(\r\n                    \"LTS\"\r\n                  )}{\" \"}\r\n                </span>\r\n              </div>\r\n            </div>\r\n\r\n            <br />\r\n              <div className=\"post-comment-comments2\">\r\n                <div className=\"postcomment1\">{commentmore.textcomment}</div>\r\n                <div className=\"imglistcomment\">\r\n                  {/* {loading ? <ClipLoader /> : <div></div>} */}\r\n                  {imagecomment\r\n                    ? imagecomment\r\n                      ? imagecomment.map((doc) => {\r\n                          return (\r\n                            <div className=\"imglistcommentpost1\">\r\n                              <img\r\n                                className=\"listcommentpost2\"\r\n                                src={`${doc.url}`}\r\n                                onClick = {() => (Setimagemodal(doc.url),handleopenmodal())}\r\n                              />\r\n                            </div>\r\n                          );\r\n                        })\r\n                      : null\r\n                    : null}\r\n                  <Modalimage isopen={isopen} handleopenmodal={handleopenmodal} handleclosemodal={handleclosemodal} imagemodal={imagemodal}/>\r\n                </div>\r\n              </div>\r\n          </div>\r\n        </div>\r\n      ) : null}\r\n    </div>\r\n  );\r\n};\r\nexport default Listcommentpost;\r\n"]},"metadata":{},"sourceType":"module"}