{"ast":null,"code":"import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import _regeneratorRuntime from\"D:/monkeyfruad/Frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"D:/monkeyfruad/Frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _toConsumableArray from\"D:/monkeyfruad/Frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"D:/monkeyfruad/Frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState,useContext}from\"react\";import{useHistory}from\"react-router-dom\";import Axios from\"axios\";import\"./commentitem.css\";import usercontext from\"../context/usercontext\";import Listcomment from\"./listcomment\";import _ from\"lodash\";import Loading from\"./pacmanloading\";import ClipLoader from\"./clipLoader\";var _require=require(\"uuid\"),uuidv4=_require.v4;var Commentitem=function Commentitem(_ref){var postid=_ref.postid;var onClick=function onClick(){return setIsActive(!isActive);};var _useContext=useContext(usercontext),user=_useContext.user,setUser=_useContext.setUser;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),imagesFile=_useState2[0],setImagesFile=_useState2[1];//สร้าง State เพื่อเก็บไฟล์ที่อัพโหลด\nvar _useState3=useState(),_useState4=_slicedToArray(_useState3,2),files=_useState4[0],Setfiles=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isActive=_useState6[0],setIsActive=_useState6[1];var _useState7=useState(),_useState8=_slicedToArray(_useState7,2),commentmore=_useState8[0],Setcommentmore=_useState8[1];var _useState9=useState(),_useState10=_slicedToArray(_useState9,2),showcommentall=_useState10[0],Setshowcommentall=_useState10[1];var _useState11=useState(true),_useState12=_slicedToArray(_useState11,2),hidebutton=_useState12[0],Sethidebutton=_useState12[1];var _useState13=useState(),_useState14=_slicedToArray(_useState13,2),click=_useState14[0],Setclick=_useState14[1];var _useState15=useState(),_useState16=_slicedToArray(_useState15,2),showdelete=_useState16[0],Setshowdelete=_useState16[1];var _useState17=useState(),_useState18=_slicedToArray(_useState17,2),showedit=_useState18[0],Setshowedit=_useState18[1];var _useState19=useState([]),_useState20=_slicedToArray(_useState19,2),item=_useState20[0],Setitem=_useState20[1];var _useState21=useState(false),_useState22=_slicedToArray(_useState21,2),checkedittext=_useState22[0],Setcheckedittext=_useState22[1];var _useState23=useState(),_useState24=_slicedToArray(_useState23,2),loading=_useState24[0],Setloading=_useState24[1];var _useState25=useState(),_useState26=_slicedToArray(_useState25,2),data=_useState26[0],Setdata=_useState26[1];var _useState27=useState(),_useState28=_slicedToArray(_useState27,2),show=_useState28[0],Setshow=_useState28[1];var _useState29=useState(),_useState30=_slicedToArray(_useState29,2),error=_useState30[0],Seterror=_useState30[1];var _useState31=useState(\"\"),_useState32=_slicedToArray(_useState31,2),textcomment=_useState32[0],Settextcomment=_useState32[1];var _useState33=useState(),_useState34=_slicedToArray(_useState33,2),photourl=_useState34[0],Setphotourl=_useState34[1];var _useState35=useState(),_useState36=_slicedToArray(_useState35,2),photopublic_id=_useState36[0],Setphotopublic_id=_useState36[1];var history=useHistory();var uuid=uuidv4();// ฟังก์ชันอัพโหลดไฟล์\nvar FileUpload=function FileUpload(event){event.preventDefault();// ใส่ไว้ไม่ให้ refresh หน้าเว็บ\nsetImagesFile([]);// reset state รูป เพื่อกันในกรณีที่กดเลือกไฟล์ซ้ำแล้วรูปต่อกันจากอันเดิม\nvar files=event.target.files;//ใช้เพื่อแสดงไฟลทั้งหมดที่กดเลือกไฟล\nSetfiles(_toConsumableArray(files));Seterror();//ทำการวนข้อมูลภายใน Array\nvar _loop=function _loop(){var reader=new FileReader();//ใช้ Class  FileReader เป็นตัวอ่านไฟล์\nreader.readAsDataURL(files[i]);//เป็นคำสั่งสำหรับการแปลง url มาเป็น file\nreader.onloadend=function(){// ใส่ข้อมูลเข้าไปยัง state ผาน  setimagesPreviewUrls\nsetImagesFile(function(prevState){return[].concat(_toConsumableArray(prevState),[reader.result]);});//  PrevState เป็น Parameter ในการเรียก State ก่อนหน้ามาแล้วรวม Array กับ fileที่อัพโหลดเข้ามา\n};};for(var i=0;i<files.length;i++){_loop();}};// console.log(files)\n// console.log(imagesFile)\nvar handledeleteimage=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(index){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:try{imagesFile.splice(index,1);setImagesFile(_toConsumableArray(imagesFile));files.splice(index,1);Setfiles(_toConsumableArray(files));}catch(err){console.log(err);}case 1:case\"end\":return _context.stop();}}},_callee);}));return function handledeleteimage(_x){return _ref2.apply(this,arguments);};}();var handlecomment=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var formdata,useruid,sentcomment;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;if(!user){_context2.next=27;break;}formdata=new FormData();useruid=user.uid;_.forEach(files,function(file){formdata.append(\"photocomment\",file);});formdata.append(\"textcomment\",textcomment);formdata.append(\"username\",data[0].username);formdata.append(\"userid\",user.uid);formdata.append(\"photourl\",photourl);formdata.append(\"photopublic_id\",photopublic_id);if(!(!files&&!textcomment)){_context2.next=12;break;}return _context2.abrupt(\"return\",Seterror(\"กรุณาใส่ข้อความหรือรูปภาพ\"));case 12:if(!(files&&files.length===0)){_context2.next=14;break;}return _context2.abrupt(\"return\",Seterror(\"กรุณาใส่ข้อความหรือรูปภาพ\"));case 14:Setloading(true);_context2.next=17;return Axios.post(\"http://localhost:7000/post/comment/\".concat(postid),formdata);case 17:sentcomment=_context2.sent;Setloading(false);Setclick(sentcomment);Settextcomment(\"\");setImagesFile([]);Setfiles();Seterror();Setloading(false);_context2.next=28;break;case 27:history.push({pathname:\"/login\",search:\"?login=false\",state:{login:false}});case 28:_context2.next=33;break;case 30:_context2.prev=30;_context2.t0=_context2[\"catch\"](0);_context2.t0&&Seterror(_context2.t0.response.data.msg);case 33:case\"end\":return _context2.stop();}}},_callee2,null,[[0,30]]);}));return function handlecomment(){return _ref3.apply(this,arguments);};}();var handlemorecomment=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:try{Setshowcommentall(true);Sethidebutton(false);}catch(err){console.log(err);}case 1:case\"end\":return _context3.stop();}}},_callee3);}));return function handlemorecomment(){return _ref4.apply(this,arguments);};}();var handledeletetorerender=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:try{Setshowdelete(uuid);}catch(err){console.log(err);}case 1:case\"end\":return _context4.stop();}}},_callee4);}));return function handledeletetorerender(){return _ref5.apply(this,arguments);};}();var handleedittorerender=/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(){return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:try{Setshowedit(uuid);}catch(err){console.log(err);}case 1:case\"end\":return _context5.stop();}}},_callee5);}));return function handleedittorerender(){return _ref6.apply(this,arguments);};}();// console.log(commentmore)\nvar gg=/*#__PURE__*/function(){var _ref7=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(){var getcommentall,nameuser,profiledata;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:_context6.prev=0;_context6.next=3;return Axios.get(\"http://localhost:7000/post/commentmore/\".concat(postid));case 3:getcommentall=_context6.sent;// Setloading(true)\nSetcommentmore(getcommentall.data.item);if(!user){_context6.next=15;break;}_context6.next=8;return Axios.post(\"http://localhost:7000/user/userid\",{result:user});case 8:nameuser=_context6.sent;Setdata(nameuser.data.item);_context6.next=12;return Axios.post(\"http://localhost:7000/user/session\",{user:user});case 12:profiledata=_context6.sent;Setphotourl(profiledata.data.data.photoURL.url);Setphotopublic_id(profiledata.data.data.photoURL.public_id);// Setloading(false)\ncase 15:_context6.next=20;break;case 17:_context6.prev=17;_context6.t0=_context6[\"catch\"](0);console.log(_context6.t0);case 20:case\"end\":return _context6.stop();}}},_callee6,null,[[0,17]]);}));return function gg(){return _ref7.apply(this,arguments);};}();useEffect(function(){gg();},[click,showdelete,showedit,postid]);return/*#__PURE__*/_jsxs(\"div\",{children:[showcommentall?/*#__PURE__*/_jsxs(\"div\",{children:[\" \",commentmore?commentmore.map(function(commentmore){return/*#__PURE__*/_jsx(Listcomment,{commentmore:commentmore,handledeletetorerender:handledeletetorerender,handleedittorerender:handleedittorerender});}):null,\" \"]}):/*#__PURE__*/_jsx(\"div\",{children:commentmore?/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Listcomment,{commentmore:commentmore[0],handledeletetorerender:handledeletetorerender,handleedittorerender:handleedittorerender}),\" \",/*#__PURE__*/_jsx(Listcomment,{commentmore:commentmore[1],handledeletetorerender:handledeletetorerender,handleedittorerender:handleedittorerender}),\" \",/*#__PURE__*/_jsx(Listcomment,{commentmore:commentmore[2],handledeletetorerender:handledeletetorerender,handleedittorerender:handleedittorerender}),\" \"]}):null}),commentmore&&commentmore.length>3?/*#__PURE__*/_jsxs(\"div\",{children:[hidebutton?/*#__PURE__*/_jsxs(\"button\",{onClick:handlemorecomment,className:\"postother2\",children:[\"\\u0E14\\u0E39\\u0E2D\\u0E35\\u0E01 \",commentmore.length-3,\" \\u0E04\\u0E27\\u0E32\\u0E21\\u0E04\\u0E34\\u0E14\\u0E40\\u0E2B\\u0E47\\u0E19\"]}):null,\" \"]}):null,/*#__PURE__*/_jsxs(\"div\",{className:\"row post-comment-comments1\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"post-profilecomment-img1\",children:photourl?/*#__PURE__*/_jsx(\"img\",{className:\"img-circle\",src:\"\".concat(photourl)}):/*#__PURE__*/_jsx(\"img\",{className:\"img-circle\",src:\"/img/profile.png\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"row post-comment-commentsall\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"container-img-holder-imgpreview1\",children:/*#__PURE__*/_jsxs(\"label\",{children:[/*#__PURE__*/_jsx(\"img\",{className:\"uploadprove1\",src:\"/img/addphoto.png\"}),/*#__PURE__*/_jsx(\"input\",{id:\"FileInput\",className:\"uploadspostcomment\",type:\"file\",onChange:FileUpload,multiple:true,accept:\"image/png, image/jpeg , image/jpg\"})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"post-writecommemt col-lg-6 col-10\",controlId:\"exampleForm.ControlTextarea1\",children:/*#__PURE__*/_jsx(\"textarea\",{rows:\"3\",cols:\"15\",className:\"inputcomment1\",placeholder:\"\\u0E40\\u0E02\\u0E35\\u0E22\\u0E19\\u0E04\\u0E27\\u0E32\\u0E21\\u0E04\\u0E34\\u0E14\\u0E40\\u0E2B\\u0E47\\u0E19...\",value:textcomment,onChange:function onChange(e){Settextcomment(e.target.value);Seterror();}})}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"div\",{className:\"column2 postbuttonsend\",children:/*#__PURE__*/_jsx(\"button\",{className:\"postbuttonsends\",onClick:function onClick(){return handlecomment();},children:/*#__PURE__*/_jsx(\"i\",{className:\"fa fa-paper-plane\"})})})}),imagesFile?imagesFile.map(function(imagePreviewUrl,index){return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"img\",{className:\"imgpreview1\",alt:\"previewImg\",src:imagePreviewUrl,style:{overflow:\"hidden\"},onMouseOver:function onMouseOver(e){return e.currentTarget.style={transform:\"scale(1.25)\",overflow:\"hidden\"};},onMouseOut:function onMouseOut(e){return e.currentTarget.style={transform:\"scale(1)\",overflow:\"hidden\"};}},index),/*#__PURE__*/_jsx(\"img\",{src:\"/img/delete.png\",onClick:function onClick(){return handledeleteimage(index);}})]});}):null]}),/*#__PURE__*/_jsx(\"h1\",{className:\"h1-postfileerror\",children:error})]})]});};export default Commentitem;","map":{"version":3,"sources":["D:/monkeyfruad/frontend/src/user/components/commentitem.js"],"names":["React","useEffect","useState","useContext","useHistory","Axios","usercontext","Listcomment","_","Loading","ClipLoader","require","uuidv4","v4","Commentitem","postid","onClick","setIsActive","isActive","user","setUser","imagesFile","setImagesFile","files","Setfiles","commentmore","Setcommentmore","showcommentall","Setshowcommentall","hidebutton","Sethidebutton","click","Setclick","showdelete","Setshowdelete","showedit","Setshowedit","item","Setitem","checkedittext","Setcheckedittext","loading","Setloading","data","Setdata","show","Setshow","error","Seterror","textcomment","Settextcomment","photourl","Setphotourl","photopublic_id","Setphotopublic_id","history","uuid","FileUpload","event","preventDefault","target","reader","FileReader","readAsDataURL","i","onloadend","prevState","result","length","handledeleteimage","index","splice","err","console","log","handlecomment","formdata","FormData","useruid","uid","forEach","file","append","username","post","sentcomment","push","pathname","search","state","login","response","msg","handlemorecomment","handledeletetorerender","handleedittorerender","gg","get","getcommentall","nameuser","profiledata","photoURL","url","public_id","map","e","value","imagePreviewUrl","overflow","currentTarget","style","transform"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, useContext } from \"react\";\r\nimport { useHistory } from \"react-router-dom\";\r\nimport Axios from \"axios\";\r\nimport \"./commentitem.css\";\r\nimport usercontext from \"../context/usercontext\";\r\nimport Listcomment from \"./listcomment\";\r\nimport _ from \"lodash\";\r\nimport Loading from \"./pacmanloading\";\r\nimport ClipLoader from \"./clipLoader\";\r\nconst { v4: uuidv4 } = require(\"uuid\");\r\nconst Commentitem = ({ postid }) => {\r\n  const onClick = () => setIsActive(!isActive);\r\n  let { user, setUser } = useContext(usercontext);\r\n\r\n  const [imagesFile, setImagesFile] = useState([]); //สร้าง State เพื่อเก็บไฟล์ที่อัพโหลด\r\n  const [files, Setfiles] = useState();\r\n  const [isActive, setIsActive] = useState(false);\r\n  const [commentmore, Setcommentmore] = useState();\r\n  const [showcommentall, Setshowcommentall] = useState();\r\n  const [hidebutton, Sethidebutton] = useState(true);\r\n  const [click, Setclick] = useState();\r\n  const [showdelete, Setshowdelete] = useState();\r\n  const [showedit, Setshowedit] = useState();\r\n  const [item, Setitem] = useState([]);\r\n  const [checkedittext, Setcheckedittext] = useState(false);\r\n\r\n  const [loading, Setloading] = useState();\r\n  const [data, Setdata] = useState();\r\n  const [show, Setshow] = useState();\r\n  const [error, Seterror] = useState();\r\n\r\n  const [textcomment, Settextcomment] = useState(\"\");\r\n  const [photourl, Setphotourl] = useState();\r\n  const [photopublic_id, Setphotopublic_id] = useState();\r\n  let history = useHistory();\r\n\r\n  let uuid = uuidv4();\r\n  \r\n  // ฟังก์ชันอัพโหลดไฟล์\r\n  const FileUpload = (event) => {\r\n    event.preventDefault(); // ใส่ไว้ไม่ให้ refresh หน้าเว็บ\r\n    setImagesFile([]); // reset state รูป เพื่อกันในกรณีที่กดเลือกไฟล์ซ้ำแล้วรูปต่อกันจากอันเดิม\r\n    let files = event.target.files; //ใช้เพื่อแสดงไฟลทั้งหมดที่กดเลือกไฟล\r\n    Setfiles([...files]);\r\n    Seterror();\r\n\r\n    //ทำการวนข้อมูลภายใน Array\r\n    for (var i = 0; i < files.length; i++) {\r\n      let reader = new FileReader(); //ใช้ Class  FileReader เป็นตัวอ่านไฟล์\r\n      reader.readAsDataURL(files[i]); //เป็นคำสั่งสำหรับการแปลง url มาเป็น file\r\n      reader.onloadend = () => {\r\n        // ใส่ข้อมูลเข้าไปยัง state ผาน  setimagesPreviewUrls\r\n        setImagesFile((prevState) => [...prevState, reader.result]);\r\n        //  PrevState เป็น Parameter ในการเรียก State ก่อนหน้ามาแล้วรวม Array กับ fileที่อัพโหลดเข้ามา\r\n      };\r\n    }\r\n  };\r\n  // console.log(files)\r\n  // console.log(imagesFile)\r\n  const handledeleteimage = async (index) => {\r\n    try{  \r\n\r\n      imagesFile.splice(index,1)\r\n      setImagesFile([...imagesFile])  \r\n\r\n      files.splice(index,1)\r\n      Setfiles([...files])\r\n      \r\n      \r\n    }catch (err) {\r\n      console.log(err);\r\n    }   \r\n  }\r\n\r\n  \r\n\r\n \r\n  const handlecomment = async () => {\r\n    try {\r\n      if (user) {\r\n        let formdata = new FormData();\r\n        let useruid = user.uid;\r\n        _.forEach(files, (file) => {\r\n          formdata.append(\"photocomment\", file);\r\n        });\r\n        formdata.append(\"textcomment\", textcomment);\r\n        formdata.append(\"username\", data[0].username);\r\n        formdata.append(\"userid\", user.uid);\r\n        formdata.append(\"photourl\", photourl);\r\n        formdata.append(\"photopublic_id\", photopublic_id);\r\n        if(!files && !textcomment){\r\n          return Seterror(\"กรุณาใส่ข้อความหรือรูปภาพ\")\r\n        }\r\n        if(files && files.length === 0){\r\n          return Seterror(\"กรุณาใส่ข้อความหรือรูปภาพ\")\r\n        }\r\n        Setloading(true)\r\n        const sentcomment = await Axios.post(\r\n          `http://localhost:7000/post/comment/${postid}`,\r\n          formdata\r\n        );\r\n        Setloading(false)\r\n        Setclick(sentcomment);\r\n        Settextcomment(\"\");\r\n        setImagesFile([]);\r\n        Setfiles()\r\n        Seterror();\r\n        Setloading(false)\r\n      } else {\r\n        history.push({\r\n          pathname: \"/login\",\r\n          search: `?login=false`,\r\n          state: {\r\n            login: false,\r\n          },\r\n        });\r\n      }\r\n    } catch (err) {\r\n      err && Seterror(err.response.data.msg);\r\n    }\r\n  };\r\n\r\n  const handlemorecomment = async () => {\r\n    try {\r\n      Setshowcommentall(true);\r\n      Sethidebutton(false);\r\n    } catch (err) {\r\n      console.log(err);\r\n    }\r\n  };\r\n\r\n  const handledeletetorerender = async () => {\r\n    try {\r\n      Setshowdelete(uuid);\r\n    } catch (err) {\r\n      console.log(err);\r\n    }\r\n  };\r\n\r\n  const handleedittorerender = async () => {\r\n    try {\r\n      Setshowedit(uuid);\r\n    } catch (err) {\r\n      console.log(err);\r\n    }\r\n  };\r\n\r\n  // console.log(commentmore)\r\n\r\n  const gg = async () => {\r\n    try {\r\n\r\n      const getcommentall = await Axios.get(\r\n        `http://localhost:7000/post/commentmore/${postid}`\r\n      );\r\n      // Setloading(true)\r\n      Setcommentmore(getcommentall.data.item);\r\n      if (user) {\r\n        const nameuser = await Axios.post(\"http://localhost:7000/user/userid\", {\r\n          result: user,\r\n        });\r\n        Setdata(nameuser.data.item);\r\n\r\n        var profiledata = await Axios.post(\r\n          \"http://localhost:7000/user/session\",\r\n          {\r\n            user: user,\r\n          }\r\n        );\r\n        Setphotourl(profiledata.data.data.photoURL.url);\r\n        Setphotopublic_id(profiledata.data.data.photoURL.public_id);\r\n        // Setloading(false)\r\n      }\r\n    } catch (err) {\r\n      console.log(err);\r\n    }\r\n  };\r\n  useEffect(() => {\r\n    gg();\r\n  }, [click, showdelete, showedit , postid]);\r\n\r\n  return (\r\n    <div>\r\n      {showcommentall ? (\r\n        <div>\r\n          {\" \"}\r\n          {commentmore\r\n            ? commentmore.map((commentmore) => {\r\n                return (\r\n                  <Listcomment\r\n                    commentmore={commentmore}\r\n                    handledeletetorerender={handledeletetorerender}\r\n                    handleedittorerender={handleedittorerender}\r\n                  />\r\n                );\r\n              })\r\n            : null}{\" \"}\r\n        </div>\r\n      ) : (\r\n        <div>\r\n          {commentmore ? (\r\n            <div>\r\n              <Listcomment\r\n                commentmore={commentmore[0]}\r\n                handledeletetorerender={handledeletetorerender}\r\n                handleedittorerender={handleedittorerender}\r\n              />{\" \"}\r\n              <Listcomment\r\n                commentmore={commentmore[1]}\r\n                handledeletetorerender={handledeletetorerender}\r\n                handleedittorerender={handleedittorerender}\r\n              />{\" \"}\r\n              <Listcomment\r\n                commentmore={commentmore[2]}\r\n                handledeletetorerender={handledeletetorerender}\r\n                handleedittorerender={handleedittorerender}\r\n              />{\" \"}\r\n            </div>\r\n          ) : null}\r\n        </div>\r\n      )}\r\n\r\n      {commentmore && commentmore.length > 3 ? (\r\n        <div>\r\n          {hidebutton ? (\r\n            <button onClick={handlemorecomment} className=\"postother2\">\r\n              ดูอีก {commentmore.length - 3} ความคิดเห็น\r\n            </button>\r\n          ) : null}{\" \"}\r\n        </div>\r\n      ) : null}\r\n\r\n      \r\n      <div className=\"row post-comment-comments1\">\r\n        <div className=\"post-profilecomment-img1\">  \r\n          {photourl ? (\r\n            <img className=\"img-circle\" src={`${photourl}`} />\r\n          ) : (\r\n            <img className=\"img-circle\" src=\"/img/profile.png\" />\r\n          )}\r\n        </div>\r\n\r\n        <div className=\"row post-comment-commentsall\">\r\n          <div className=\"container-img-holder-imgpreview1\">\r\n            <label>\r\n              <img className=\"uploadprove1\" src=\"/img/addphoto.png\" />\r\n              <input\r\n                id=\"FileInput\"\r\n                className=\"uploadspostcomment\"\r\n                type=\"file\"\r\n                onChange={FileUpload}\r\n                multiple\r\n                accept=\"image/png, image/jpeg , image/jpg\"\r\n              />\r\n            </label>\r\n          </div>\r\n\r\n          <div\r\n            className=\"post-writecommemt col-lg-6 col-10\"\r\n            controlId=\"exampleForm.ControlTextarea1\"\r\n          >\r\n               \r\n            <textarea\r\n              rows=\"3\"\r\n              cols=\"15\"\r\n              className=\"inputcomment1\"\r\n              placeholder=\"เขียนความคิดเห็น...\"\r\n              value={textcomment}\r\n              onChange={(e) => {\r\n                Settextcomment(e.target.value) \r\n                Seterror()\r\n              }}\r\n            />\r\n             {/* {loading ? <div><ClipLoading/></div> : null } */}\r\n          </div>\r\n         \r\n          <div>\r\n            <div className=\"column2 postbuttonsend\">\r\n              <button\r\n                className=\"postbuttonsends\"\r\n                onClick={() => handlecomment()}\r\n              >\r\n                <i className=\"fa fa-paper-plane\"></i>\r\n              </button>\r\n            </div>\r\n          </div>\r\n       \r\n          {imagesFile ? imagesFile.map((imagePreviewUrl,index) => {\r\n            return (\r\n              <div>\r\n                \r\n              <img\r\n                key={index}\r\n                className=\"imgpreview1\"\r\n                alt=\"previewImg\"\r\n                src={imagePreviewUrl}\r\n                style={{ overflow: \"hidden\" }}\r\n                onMouseOver={(e) =>\r\n                  (e.currentTarget.style = {\r\n                    transform: \"scale(1.25)\",\r\n                    overflow: \"hidden\",\r\n                  })\r\n                }\r\n                onMouseOut={(e) =>\r\n                  (e.currentTarget.style = {\r\n                    transform: \"scale(1)\",\r\n                    overflow: \"hidden\",\r\n                  })\r\n                }\r\n              />\r\n              <img src=\"/img/delete.png\"onClick={() => handledeleteimage(index)} />\r\n              </div>\r\n            );\r\n          }): null}\r\n        </div>\r\n\r\n        <h1 className=\"h1-postfileerror\">{error}</h1>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Commentitem;\r\n"]},"metadata":{},"sourceType":"module"}